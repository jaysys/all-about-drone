ESP32-D (ESP32-WROOM-32)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë“œë¡ ì˜ **Flight Control Computer (FCC)** ë¥¼ ê°œë°œí•˜ëŠ” ê²ƒì€ ì¶©ë¶„íˆ ê°€ëŠ¥í•˜ë©°, FreeRTOSì˜ ë©€í‹°íƒœìŠ¤í‚¹ ê¸°ëŠ¥ì„ í™œìš©í•˜ë©´ **ë¹„í–‰ ì œì–´, ì„¼ì„œ ìˆ˜ì§‘, í†µì‹  ì²˜ë¦¬, ëª…ë ¹ ì²˜ë¦¬** ë“±ì„ íš¨ìœ¨ì ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## âœˆï¸ FCC ì„¤ê³„ ê°œìš” (FreeRTOS ê¸°ë°˜)

### âœ… 1. ì£¼ìš” ê¸°ëŠ¥ ë¶„ë¥˜ (Task ë ˆë²¨ ë¶„í•´)

| Task ì´ë¦„              | ì—­í•  ì„¤ëª…                                                |
| ---------------------- | -------------------------------------------------------- |
| **Sensor Task**        | IMU, Barometer, GPS ë“±ì—ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ì„¼ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘ |
| **Stabilizer Task**    | ì„¼ì„œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ PID ì œì–´ â†’ Roll, Pitch, Yaw ê³„ì‚°  |
| **Motor Control Task** | PWM ì‹ í˜¸ë¥¼ í†µí•´ ëª¨í„° ìŠ¤ë¡œí‹€ ì œì–´                         |
| **Command Task**       | ì‚¬ìš©ì ì…ë ¥ ìˆ˜ì‹  (RC ìˆ˜ì‹ ê¸°, UART, BLE ë“±)               |
| **Telemetry Task**     | ìƒíƒœ ì •ë³´ ì „ì†¡ (UART, WiFi, Bluetooth ë“±)                |
| **Failsafe Task**      | ì„¼ì„œ/í†µì‹  ì˜¤ë¥˜ ê°ì§€ â†’ ê¸´ê¸‰ ì°©ë¥™ ìˆ˜í–‰                     |

---

## âœ… 2. ê¶Œì¥ Task êµ¬ì„± ì˜ˆ (6ê°œ)

| Task ì´ë¦„        | ì£¼ê¸° (Hz)  | ìš°ì„ ìˆœìœ„ | ì½”ì–´ í• ë‹¹ | ì„¤ëª…                              |
| ---------------- | ---------- | -------- | --------- | --------------------------------- |
| `TaskSensor`     | 100\~500Hz | 2        | Core 1    | IMU, ê³ ë„ê³„, GPS ë“± ìˆ˜ì§‘          |
| `TaskStabilizer` | 100\~250Hz | 3        | Core 1    | ì„¼ì„œê°’ìœ¼ë¡œ ìì„¸ ì œì–´ (PID)        |
| `TaskMotorCtrl`  | 100\~250Hz | 3        | Core 0    | PWM ê³„ì‚° â†’ ëª¨í„°ì— ëª…ë ¹            |
| `TaskCommand`    | 50Hz       | 1        | Core 0    | ëª…ë ¹ ì…ë ¥ (BLE/UART/RC)           |
| `TaskTelemetry`  | 10\~20Hz   | 1        | Core 0    | ë°ì´í„° ì „ì†¡ (WiFi/BT/UART)        |
| `TaskFailsafe`   | 5Hz        | 2        | Core 1    | ì—°ê²°, ì„¼ì„œ ì´ìƒ ê°ì§€ ë° ì´íƒˆ ì²˜ë¦¬ |

---

## âœ… 3. Task ê°„ í†µì‹  êµ¬ì¡° (Command & Control ì„¤ê³„)

FreeRTOSì—ì„œ Task ê°„ ë©”ì‹œì§€ ì „ë‹¬ ë° ì œì–´ë¥¼ ìœ„í•´ ë‹¤ìŒì„ ì‚¬ìš©í•©ë‹ˆë‹¤:

| êµ¬ì¡°                      | ì—­í•                                                  |
| ------------------------- | ---------------------------------------------------- |
| **Queue**                 | ëª…ë ¹ ì „ë‹¬ (ex. Command â†’ Stabilizer)                 |
| **Semaphore / Mutex**     | ë¦¬ì†ŒìŠ¤ ë³´í˜¸ (ex. ì„¼ì„œ ë²„ìŠ¤, IMU SPI ë“±)              |
| **EventGroup**            | ì´ë²¤íŠ¸ ë°œìƒ ê°ì§€ (ex. GPS Fix ì™„ë£Œ, RC ì‹ í˜¸ ì—†ìŒ ë“±) |
| **Shared Memory + Mutex** | ì‹¤ì‹œê°„ ì„¼ì„œ ë°ì´í„° ê³µìœ                               |

---

### ğŸ”„ ì˜ˆì‹œ: Command â†’ Stabilizer â†’ Motor ì œì–´ íë¦„

```
CommandTask
  â†“ (Queue)
StabilizerTask (PID ê³„ì‚°)
  â†“ (Shared data or Queue)
MotorCtrlTask (PWM ì¶œë ¥)
```

---

### ğŸ“¦ ì˜ˆì‹œ: ì„¼ì„œ ë°ì´í„°ë¥¼ Stabilizerì™€ Telemetryì— ê³µìœ 

```
SensorTask
  â”œâ”€â”€ ê³µìœ  êµ¬ì¡°ì²´ imuData{} ë¥¼ ê°±ì‹  (mutex ë³´í˜¸)
  â”œâ”€â”€ stabilizerTaskëŠ” ì´ êµ¬ì¡°ì²´ë¥¼ ì°¸ì¡°
  â””â”€â”€ telemetryTaskëŠ” ì½ì–´ì„œ ì „ì†¡
```

---

## âœ… 4. ì½”ì–´ ë°°ì¹˜ ì „ëµ

ESP32ëŠ” ë“€ì–¼ì½”ì–´ MCUì´ë¯€ë¡œ ì‹¤ì‹œê°„ Taskë¥¼ Core 1ì—, ë¹„ì‹¤ì‹œê°„ Taskë¥¼ Core 0ì— ë°°ì¹˜í•©ë‹ˆë‹¤.

| Core 1 (ê³ ì†/ì‹¤ì‹œê°„) | Core 0 (ì €ì†/í†µì‹ ) |
| -------------------- | ------------------ |
| SensorTask           | CommandTask        |
| StabilizerTask       | TelemetryTask      |
| MotorCtrlTask        | FailsafeTask       |

---

## âœ… 5. ìš”ì•½: ì„¤ê³„ ì˜ˆì‹œ êµ¬ì¡°ë„

```plaintext
                      +---------------------+
                      |     CommandTask     | â† BLE, UART, RC
                      +---------+-----------+
                                |
                                v (Queue)
                      +---------------------+
                      |   StabilizerTask    | â† PID
                      +---------+-----------+
                                |
                                v
                      +---------------------+
                      |   MotorCtrlTask     | â†’ PWM
                      +---------------------+

SensorTask â†’ [IMU, GPS, Baro] â†’ ê³µìœ  êµ¬ì¡°ì²´ (imuData) â† ì°¸ì¡° by Stabilizer, Telemetry
FailsafeTask â† ì„¼ì„œ ì—ëŸ¬, RC ì‹ í˜¸ ì—†ìŒ ê°ì§€
TelemetryTask â†’ GroundStation ì „ì†¡ (WiFi/UART)
```

---

## âœ… FreeRTOS ê¸°ëŠ¥ë³„ ì œì•ˆ

| ê¸°ëŠ¥             | ì¶”ì²œ API                                        |
| ---------------- | ----------------------------------------------- |
| ë©”ì‹œì§€ ì „ì†¡      | `xQueueSend()`, `xQueueReceive()`               |
| ì„¼ì„œ ì ‘ê·¼ ë™ê¸°í™” | `xSemaphoreTake()`, `xSemaphoreGive()`          |
| ì´ë²¤íŠ¸ ì²˜ë¦¬      | `xEventGroupSetBits()`, `xEventGroupWaitBits()` |
| ì£¼ê¸° ë°˜ë³µ        | `vTaskDelayUntil()`                             |

---

## âœ… ê°œë°œ í™•ì¥ íŒ

- IMU ì„¼ì„œ (MPU6050, ICM20948 ë“±) â†’ I2C/SPI + Sensor Fusion (Madgwick Filter)
- PWM ì œì–´ â†’ `ledcWrite()`, í˜¹ì€ ì™¸ë¶€ ESC PWM
- PID ì œì–´ â†’ ë‹¨ìˆœ êµ¬í˜„ or ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©
- OTA ì—…ë°ì´íŠ¸, Logging, Emergency EEPROM ì €ì¥ ë“±ë„ ê³ ë ¤ ê°€ëŠ¥

---

í•„ìš”í•˜ì‹œë©´ ì•„ë˜ ì¤‘ ì¶”ê°€ë¡œ êµ¬ì„±í•´ë“œë¦´ ìˆ˜ ìˆì–´ìš”:

- ğŸ§  PID ì œì–´ Task ìƒ˜í”Œ
- ğŸ“¡ CommandTask ì˜ˆì œ (BLE/UART ê¸°ë°˜)
- ğŸ“Š SensorTaskì—ì„œ MPU6050 ìˆ˜ì§‘ ì½”ë“œ
- ğŸ“œ ì „ì²´ êµ¬ì¡°ì˜ C++ í´ë˜ìŠ¤ ê¸°ë°˜ ì„¤ê³„

ì–´ë–¤ ë¶€ë¶„ë¶€í„° êµ¬í˜„í•˜ì‹œê² ì–´ìš”?
